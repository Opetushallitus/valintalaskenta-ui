<html ng-app="valintalaskenta-jononhallinta">
<head>
    <link href="../../common/css/bootstrap-3.1.1/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../common/css/font-awesome-4.0.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../common/css/ng-table.css" rel="stylesheet" type="text/css"/>
    <link href="../../common/css/valintalaskenta.css" rel="stylesheet" type="text/css"/>

    <script type="text/javascript" src="/virkailija-raamit/apply-raamit.js"></script>
</head>
<body>
    <div id="application-wrapper" ng-controller="DashboardController">
        <h1>Valintalaskennat</h1>
        <div id="stateSelector" class="flexContainer">
            <div id="stateSelectorPanelBody">
                NÄYTÄ
                <button class="btn btn-stateSelectorButton" ng-model="stateFilters.MENEILLAAN" uib-btn-checkbox>
                    <span ng-show="stateFilters.MENEILLAAN" class="glyphicon glyphicon-ok"></span>
                    Käynnissä {{ jobsByState.MENEILLAAN.length || 0 }}
                </button>
                <button class="btn btn-stateSelectorButton" ng-model="stateFilters.ALOITTAMATTA" uib-btn-checkbox>
                    <span ng-show="stateFilters.ALOITTAMATTA" class="glyphicon glyphicon-ok"></span>
                    Jonossa {{ jobsByState.ALOITTAMATTA.length || 0 }}
                </button>
                <button class="btn btn-stateSelectorButton" ng-model="stateFilters.PERUUTETTU " uib-btn-checkbox>
                    <span ng-show="stateFilters.PERUUTETTU" class="glyphicon glyphicon-ok"></span>
                    Keskeytynyt {{ jobsByState.PERUUTETTU.length || 0 }}
                </button>
                <button class="btn btn-stateSelectorButton" ng-model="stateFilters.VALMIS" uib-btn-checkbox>
                    <span ng-show="stateFilters.VALMIS" class="glyphicon glyphicon-ok"></span>
                    Valmis {{ jobsByState.VALMIS.length || 0 }}
                </button>
            </div>
        </div>
        <div id="jobList">
            <div ng-repeat="job in jobs | filter:isShown" class="flexContainer">
                <div class="jobListItem details">
                    <div class="top">
                      <span class="jobItemHeading">{{ stateToHumanReadable(job.tila) }}</span>
                      <span class="jobItemStartTime">{{ job.luotu | date : "d.M.yyyy 'klo' H:m" }}</span>
                    </div>
                    <div class="middle">
                        <span class="jobItemUser glyphicon glyphicon-user glyph-background"></span> 
                        <a href="/authentication-henkiloui/html/index.html#/henkilo/{{job.userOID}}/">{{ userCache[job.userOID] }}</a>
                        <span class="jobItemRunningTime glyphicon glyphicon-time glyph-background"></span>  {{ job.luotu | timeFromNow }}
                        <span ng-show="job.hakukohteitaKeskeytetty > 0">
                          <span class="jobItemErrors glyphicon glyphicon-warning-sign glyph-background"></span>
                          <a class="errorLink" href="resources/valintalaskentakerralla/status/{{job.uuid}}/xls" >Virheitä ({{ job.hakukohteitaKeskeytetty}})</a>
                        </span>
                    </div>
                    <div class="bottom">
                        <div class="progressBar">
                            <uib-progressbar class="progress"
                              value="job.hakukohteitaValmiina"
                              max="job.hakukohteitaYhteensa"
                              type="{{ progressBarType(job.tila) }}">
                            </uib-progressbar>
                        </div>
                        <div class="progressPercent">
                            {{job.hakukohteitaValmiina / job.hakukohteitaYhteensa * 100}} %
                        </div>
                    </div>
                </div>
                <div class="jobListItem left-border description">
                    <div ng-show="job.tila === 'ALOITTAMATTA'" class="pull-right">
                        <span ng-click="removeJob(job)" class="glyphicon glyphicon-remove glyph-background actionButton"></span>
                    </div>

                    <div class="jobItemDescription">{{job.haunnimi}}</div>
                    <div class="jobItemQueue">{{job.valintatapa}}</div>

                </div>
          </div>
      </div>
    </div>

    <script src="../../common/jslib/angular.min.js" type="text/javascript"></script>
    <script src="../../common/jslib/lodash.underscore.min.js" type="text/javascript"></script>
    <script src="../../common/jslib/angular-resource.min.js"></script>
    <script src="../../common/jslib/moment-with-locales.min.js"></script>
    <script src="../../common/jslib/ui-bootstrap-tpls-1.3.2.min.js" type="text/javascript"></script>
    <script src="hallinta.js"></script>

</body>
</html>
