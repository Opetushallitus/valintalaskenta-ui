<h1>{{ t('yhteisvalinnanhallinta.header') || 'Valintojen toteuttaminen' }}</h1>

<div ng-include="'../common/js/topnavigation/topNavigation.html'"/>

<div class="tabsheets">



<!-- HAUN TIEDOT -->
<collapsible show="false" heading="{{ t('yhteisvalinnanhallinta.tiedot') || 'Haun tiedot' }}">
    <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.haku') || 'Haku' }}</strong></div>
    <div class="col-md-10 margin-bottom-1">{{hakumodel.hakuOid.nimi.kieli_fi}}</div>

    <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.hauntunniste') || 'Haun tunniste' }}</strong></div>
    <div class="col-md-10 margin-bottom-1">{{hakumodel.hakuOid.haunTunniste}}</div>

    <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.hakuvuosi') || 'Hakuvuosi' }}</strong></div>
    <div class="col-md-10 margin-bottom-1">{{hakumodel.hakuOid.hakukausiVuosi}}</div>

    <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.sijoittelu') || 'Sijoittelu' }}</strong></div>
    <div class="col-md-10 margin-bottom-1">{{hakumodel.hakuOid.sijoittelu ? 'Kyllä' : 'Ei'}}</div>

    <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.hakuajat') || 'Hakuajat' }}</strong></div>
    <div class="col-md-10 margin-bottom-1">
        <ul class="list-unstyled">
            <li ng-repeat="hakuaika in hakumodel.hakuOid.hakuaikas">
                <strong ng-if="hakumodel.hakuOid.hakuaikas.length > 1">{{hakuaika.nimi}}</strong>
                <span>{{hakuaika.alkuPvm | date:'dd.MM.yyyy HH:mm'}} - {{hakuaika.loppuPvm | date:'dd.MM.yyyy HH:mm'}}</span>
            </li>
        </ul>
    </div>


</collapsible>

<!-- VALINTALASKENTA JA SIJOITTELU -->
<collapsible ng-if="!hakumodel.hakuOid.lisahaku" heading="{{ t('yhteisvalinnanhallinta.valintalaskentajasijoittelu') || 'Valintalaskenta ja sijoittelu' }}" is-open="false">
    <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.valintalaskenta') || 'Valintalaskenta' }}</strong></div>
    <div class="col-md-10 margin-bottom-2">
        <button privileges="valintakoekutsut" ng-click="aktivoiHaunValintakoelaskenta()"
                class="btn btn-primary btn-sm">{{ t('yhteisvalinnanhallinta.suoritahaulle') || 'Suorita valintakoelaskenta haulle' }}
        </button>
        <button privileges="valintakoekutsut" ng-click="aktivoiHaunValintalaskenta()"
                class="btn btn-primary btn-sm">{{ t('yhteisvalinnanhallinta.suoritavalintalaskenta') || 'Suorita valintalaskenta haulle' }}
        </button>
        <button privileges="valintalaskenta" ng-click="aktivoiValintalaskentaKerralla()"
                class="btn btn-primary btn-sm">{{ t('yhteisvalinnanhallinta.suoritavalintalaskentajavalintakoelaskentahaulle') || 'Suorita valintalaskenta ja valintakoelaskenta haulle' }}
        </button>
    </div>
    <div ng-if="!hakumodel.hakuOid.erillishaku">
        <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.sijoittelu') || 'Sijoittelu' }}</strong></div>
        <div class="col-md-10 margin-bottom-2">
            <button ng-click="kaynnistaSijoittelu()" class="btn btn-primary btn-sm">{{ t('yhteisvalinnanhallinta.suoritasijoittelu') || 'Suorita sijoittelu' }}
            </button>
            <button ng-if="!jatkuva.ajossa" ng-click="kaynnistaJatkuvaSijoittelu()"
                    class="btn btn-primary btn-sm">{{ t('yhteisvalinnanhallinta.kayttoonajastettu') || 'Ota käyttöön ajastettu sijoittelu' }}
            </button>
            <button ng-if="jatkuva.ajossa" ng-click="pysaytaJatkuvaSijoittelu()"
                    class="btn btn-primary btn-sm">{{ t('yhteisvalinnanhallinta.poistaajastettu') || 'Poista käytöstä ajastettu sijoittelu' }}
            </button>
        </div>
    </div>

    <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.ajotiheys') || 'Sijoittelun ajotiheys (t)' }}</strong></div>
    <div class="col-md-10 margin-bottom-1"><input type="number" min="0" max="24" id="ajotiheys" name="ajotiheys"
                                                  ng-model="jatkuva.ajotiheys"/></div>

    <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.aloitusajankohta') || 'Sijoittelun aloitusajankohta' }}</strong></div>
    <div class="col-md-10 margin-bottom-1">
        <div style="display:inline-block;">
            <datepicker ng-model="jatkuva.aloitusajankohta_date" min-date="minDate" show-weeks="true" class="well well-sm"></datepicker>
        </div>
        <timepicker ng-model="jatkuva.aloitusajankohta_time" hour-step="1" minute-step="1" show-meridian="false"></timepicker>
    </div>
    <div class="offset-left-12-2 col-md-10 margin-bottom-1">
        <button ng-click="paivitaJatkuvanSijoittelunAloitus()"
                class="btn btn-primary btn-sm">{{ t('yhteisvalinnanhallinta.paivita') || 'Päivitä' }}
        </button>
    </div>
    <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.sijoitteluajettu') || 'Edellinen onnistunut sijoittelu' }}</strong></div>
    <div class="col-md-10 margin-bottom-1">{{sijoitteluModel.startMils | date:'dd.MM.yyyy HH:mm'}} -
        {{sijoitteluModel.endMils |
        date:'dd.MM.yyyy HH:mm'}}
    </div>
    <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.sijoitteluajossa') || 'Sijoittelu ajossa' }}</strong></div>
    <div class="col-md-10 margin-bottom-1">{{jatkuva.ajossa ? 'Kyllä' : 'Ei'}}</div>

    <div class="col-md-2"><strong class="pull-right">{{ t('yhteisvalinnanhallinta.viimeksiajettu') || 'Edellinen ajastetun sijoittelun ajankohta' }}</strong></div>
    <div class="col-md-10 margin-bottom-1">{{jatkuva.viimeksiAjettu | date:'dd.MM.yyyy HH:mm'}}</div>

    <div ng-if="jatkuva.virhe">
        <div class="col-md-2"><strong>{{ t('yhteisvalinnanhallinta.ajastettuvirhe') || 'Ajastetun sijoittelun virhe' }}</strong></div>
        <div class="col-md-10">{{jatkuva.virhe}}</div>
    </div>
</collapsible>

<!-- SIJOITTELUN TULOKSET -->
<collapsible heading="{{ t('yhteisvalinnanhallinta.sijoitteluntulokset') || 'Kirjeet ja sijoittelun tulokset' }}">
    <button privileges="valintalaskenta" ng-click="sijoittelunTuloksetTaulukkolaskentaan()"
            class="btn btn-default btn-sm"><i class="fa fa-table"></i>&nbsp;{{ t('yhteisvalinnanhallinta.vietaulukkolaskentaan') || 'Vie taulukkolaskentaan' }}
    </button>
    <button privileges="valintalaskenta" ng-click="sijoittelunTuloksetOsoitetarrat()"
            class="btn btn-default btn-sm"><i class="fa fa-table"></i>&nbsp;{{ t('yhteisvalinnanhallinta.vieosoitetarroiksi') || 'Vie osoitetarroiksi' }}
    </button>
    <button ng-if="!iskorkeakoulu" privileges="valintalaskenta" ng-click="aktivoiJalkiohjaustuloksetXls()"
            class="btn btn-default btn-sm"><i class="fa fa-table"></i>&nbsp;{{ t('yhteisvalinnanhallinta.viejalkiohjaustuloksettaulukkolaskentaan') || 'Vie jälkiohjaustulokset taulukkolaskentaan' }}
    </button>
    <button ng-if="iskorkeakoulu" privileges="valintalaskenta" ng-click="aktivoiJalkiohjaustuloksetXls()"
            class="btn btn-default btn-sm"><i class="fa fa-table"></i>&nbsp;{{ t('yhteisvalinnanhallinta.vieeihyvaksyttyjentuloksettaulukkolaskentaan') || 'Vie ei-hyväksyttyjen tulokset taulukkolaskentaan' }}
    </button>
    <button privileges="valintalaskenta"
            href="#/haku/{{hakumodel.hakuOid.oid}}/yhteisvalinnanhallinta/valintatulos"
            class="btn btn-default btn-sm">{{ t('yhteisvalinnanhallinta.valinnantulokset') || 'Valinnan tulokset' }}
    </button>

    <br>
    <hr>

    <form class="form-inline">
        <div class="form-group">
            <label for="kirjeenTyyppi">Kirje</label>
            <select ng-init="ishyvaksymiskirje = 'true'" ng-model="ishyvaksymiskirje" id="kirjeenTyyppi" class="form-control">
                <option value="true">hyväksymiskirje</option>
                <option value="false" ng-if="iskorkeakoulu">ei-hyväksyttyjen kirje</option>
                <option value="false" ng-if="!iskorkeakoulu">jälkiohjauskirje</option>
            </select>
        </div>
        <div class="form-group">
            <label for="kirjeenKieli">kieli</label>
            <select ng-init="langcode = 'EN'" ng-model="langcode" id="kirjeenKieli" class="form-control">
                <option value="FI">suomi</option>
                <option value="SV">ruotsi</option>
                <option value="EN">englanti</option>
            </select>
        </div>
        <button ng-click="muodostaKirjeet(ishyvaksymiskirje=='true',langcode);" class="btn btn-default">{{ t('yhteisvalinnanhallinta.muodostakirjeet') || 'Muodosta kirjeet'}}</button>
    </form>
    <br>


</collapsible>

    <!--KELAN TIEDONSIIRTO-->
<collapsible ng-click="showKelaCollapsible = true" heading="{{ t('yhteisvalinnanhallinta.kelantiedonsiirto') || 'Kelan tiedonsiirto' }}">
    <div ng-if="showKelaCollapsible">
        <div class="form-horizontal">
            <div class="form-group">
                <label class="col-md-2 control-label" for="aineistonnimi">{{ t('yhteisvalinnanhallinta.keladokumentinmuodostus') || 'Kela-dokumentin muodostus' }}</label>

                <div class="col-md-2">
                    <input class="form-control" id="aineistonnimi" placeholder="{{ t('yhteisvalinnanhallinta.aineistonnimi') || 'Aineistonnimi' }}"
                           ng-model="aineistonnimi"  maxlength="26"/>
                </div>

                <div class="col-md-2">
                     <button style="margin-top: 5px" ng-if="!isNotBlank(aineistonnimi) || !aineistoAlkupvm || !aineistoLoppupvm" privileges="valintalaskenta"
                            popover="{{ t('yhteisvalinnanhallinta.kirjoitanimi') || 'Kirjoita aineistolle nimi.' }}" popover-trigger="mouseenter"
                            class="btn btn-default btn-sm disabled"><i class="fa fa-file"></i>&nbsp;{{ t('yhteisvalinnanhallinta.muodostakeladokumentti') || 'Muodosta Kela-dokumentti' }}
                    </button>

                    <button style="margin-top: 5px" ng-if="isNotBlank(aineistonnimi)  && aineistoAlkupvm && aineistoLoppupvm" privileges="valintalaskenta"
                            ng-click="muodostaKelaDokumentti(aineistoAlkupvm,aineistoLoppupvm,aineistonnimi);$event.preventDefault();"
                            class="btn btn-default btn-sm"><i class="fa fa-file"></i>&nbsp;{{ t('yhteisvalinnanhallinta.muodostakeladokumentti') || 'Muodosta Kela-dokumentti' }}
                    </button>
                </div>
                <div class="col-md-12">
                </div>
           </div>
        </div>
        <div class="form-horizontal">
            <div class="form-group">
                <label class="col-md-2 control-label" for="aineistoAlkupvm">{{ t('yhteisvalinnanhallinta.alkujaloppupvm') || 'Alku- ja loppupvm' }}</label>
                <div class="col-md-2">
                    <input class="form-control" id="aineistoAlkupvm" placeholder="{{ t('yhteisvalinnanhallinta.alkupvm') || 'Alkupvm' }}"
                           ng-model="aineistoAlkupvm" datepicker-popup="dd.MM.yyyy" is-open="aineistoAlkupvm_open"
                           ng-click = "aineistoAlkupvm_open = true" datepicker-options="dateOptions" ng-blur="visitedDate = true"
                           max-date="maxdate" show-button-bar="false"
                          />
                </div>
                <div class="col-md-2">
                    <input class="form-control" id="aineistoLoppupvm" placeholder="{{ t('yhteisvalinnanhallinta.loppupvm') || 'Loppupvm' }}"
                           ng-model="aineistoLoppupvm" datepicker-popup="dd.MM.yyyy" is-open="aineistoLoppupvm_open"
                           ng-click = "aineistoLoppupvm_open = true" datepicker-options="dateOptions"
                           ng-blur="visitedDate = true" max-date="maxdate" min-date="aineistoAlkupvm" show-button-bar="false"
                           />
                </div>
                <div class="col-md-12">
                </div>
           </div>
        </div>
        <div class="col-md-12 margin-bottom-2" ng-hide="naytetaanHaut">
            <button class="btn btn-default btn-sm" ng-click="kelalimit=10;naytaHaut();$event.preventDefault();"><i class="fa fa-eye"></i>
                {{ t('yhteisvalinnanhallinta.naytahaut') || 'Näytä haut' }}
            </button>
        </div>
        <div ng-show="naytetaanHaut" class="form-horizontal">

            <div class="form-group">
                <label class="col-md-2 control-label" for="hakuvuosi">{{t('hakulista.hakuvuosi') || 'Hakuvuosi'}}</label>

                <div class="col-md-2">
                    <select class="form-control input-sm"
                            id="hakuvuosi"
                            ng-model="kelafilter.hakuvuosi"
                            ng-change="kelaUpdate(kelafilter)"
                            ng-options="hakuvuosi for hakuvuosi in customHakuUtil.hakuvuodetOpts">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-md-2 control-label" for="hakukausi">{{t('hakulista.hakukausi') || 'Hakukausi'}}</label>

                <div class="col-md-2">
                    <select class="form-control input-sm"
                            id="hakukausi"
                            ng-model="kelafilter.hakukausi"
                            ng-change="kelaUpdate(kelafilter)"
                            ng-options="hakukausi.koodiUri as hakukausi.nimi for hakukausi in customHakuUtil.hakukausiOpts"
                            placeholder="Hakukausi">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-md-2 control-label" for="hakutapa">{{t('hakulista.hakutapa') || 'Hakutapa'}}</label>

                <div class="col-md-2">
                    <select class="form-control input-sm"
                            id="hakutapa"
                            ng-model="kelafilter.hakutapa"
                            ng-change="kelaUpdate(kelafilter)"
                            ng-options="hakutapa.koodiUri as hakutapa.nimi for hakutapa in customHakuUtil.hakutapaOpts">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-md-2" for="kohdejoukko">{{t('hakulista.kohdejoukko') || 'Kohdejoukko'}}</label>

                <div class="col-md-2">
                    <select class="form-control input-sm"
                            id="kohdejoukko"
                            ng-model="kelafilter.kohdejoukko"
                            ng-change="kelaUpdate(kelafilter)"
                            ng-options="kohdejoukko.koodiUri as kohdejoukko.nimi for kohdejoukko in customHakuUtil.kohdejoukkoOpts">
                        <option></option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label col-md-2" for="hakutyyppi">{{t('hakulista.hakutyyppi') || 'Hakutyyppi'}}</label>

                <div class="col-md-2">
                    <select class="form-control input-sm"
                            id="hakutyyppi"
                            ng-model="kelafilter.hakutyyppi"
                            ng-change="kelaUpdate(kelafilter)"
                            ng-options="hakutyyppi.koodiUri as hakutyyppi.nimi for hakutyyppi in customHakuUtil.hakutyyppiOpts">
                        <option></option>
                    </select>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <table class="virkailija-table-1">
                <thead>
                <tr>
                    <th colspan="3">{{ t('yhteisvalinnanhallinta.muodostavalituista') || 'Kela-dokumentti muodostetaan valituista hauista' }}</th>
                </tr>
                <tr>
                    <th class="col-sm-1"><input type="checkbox" ng-checked="kaikkiHautValittu" ng-click="switchChecked()"></th>
                    <th>{{ t('yhteisvalinnanhallinta.haku') || 'Haku' }}</th>
                    <th>{{ t('yhteisvalinnanhallinta.oid') || 'Oid' }}</th>
                </tr>
                </thead>
                <tbody>
                <tr class="info">
                    <td><input disabled="disabled" type="checkbox" checked="checked"></td>
                    <td>{{hakumodel.hakuOid.nimi.kieli_fi}}<span ng-hide="hakumodel.hakuOid.nimi.kieli_fi">{{haku.nimi.kieli_sv}}</span>
                    </td>
                    <td>{{hakumodel.hakuOid.oid}}</td>
                </tr>
                <tr ng-show="naytetaanHaut" ng-repeat="haku in hakumodel.haut | filter:notThisHaku | filter:{hakukausiVuosi:nullIsUndefined(kelafilter.hakuvuosi),hakukausiUri:nullIsUndefined(kelafilter.hakukausi),hakutapaUri:nullIsUndefined(kelafilter.hakutapa),kohdejoukkoUri:nullIsUndefined(kelafilter.kohdejoukko),hakutyyppiUri:nullIsUndefined(kelafilter.hakutyyppi)} | limitTo:kelalimit">
                    <td><input type="checkbox" ng-model="haku.valittu" ></td>
                    <td>{{haku.nimi.kieli_fi}}<span ng-hide="haku.nimi.kieli_fi">{{haku.nimi.kieli_sv}}</span></td>
                    <td>{{haku.oid}}</td>
                </tr>
                <tr ng-show="kelalimit == 10">
                    <td span="3">
                        <button class="btn btn-default btn-sm" ng-click="kelalimit = 100000;"><i class="fa fa-eye"></i>
                            {{ t('yhteisvalinnanhallinta.naytahaut.laajenna') || 'Laajenna' }}
                        </button>
                    </td>
                </tr>
                <tr ng-hide="kelalimit == 10">
                    <td span="3">
                        <button class="btn btn-default btn-sm" ng-click="kelalimit = 10;"><i class="fa fa-eye"></i>
                            {{ t('yhteisvalinnanhallinta.naytahaut.piilota') || 'Piilota' }}
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</collapsible>


<!-- VIRHEET VALINTAKOKEISSA JA LASKENNOISSA -->
<collapsible heading="Virheet valintakokeissa ja laskennoissa" privileges="valintalaskenta" ng-click="showErrors()">
    <div ng-show="virheet.valintakoe.length > 0 || virheet.valintalaskenta.length > 0 || virheet.eiKoeVirheita || virheet.eiLaskentaVirheita">
        <div class="tabs">
            <a class="tab" ng-class="!valintalaskentavirheet ? 'current' : ''"
               ng-click="valintalaskentavirheet = false">
                <span>{{ t('yhteisvalinnanhallinta.valintakoevirheet') || 'Valintakoevirheet' }}</span>
            </a>
            <a class="tab" ng-class="valintalaskentavirheet ? 'current' : ''" ng-click="valintalaskentavirheet = true">
                <span>{{ t('yhteisvalinnanhallinta.valintalaskentavirheet') || 'Valintalaskentavirheet' }}</span>
            </a>
        </div>
        <div class="clear"></div>

        <div class="tabsheets hakuVirheet">
            <div ng-show="!valintalaskentavirheet">
                <h2 ng-show="virheet.eiKoeVirheita">{{ t('yhteisvalinnanhallinta.eivirheita') || 'Ei virheitä valintakokeissa' }}</h2>

                <h2 ng-show="virheet.valintakoe.length > 0">{{ t('yhteisvalinnanhallinta.valintakoevirheet') || 'Valintakoevirheet' }} ({{virheet.valintakoe.length}})</h2>

                <input ng-show="virheet.valintakoe.length > 0" type="text" class="search margin-vertical-2"
                       placeholder="{{ t('yhteisvalinnanhallinta.suodatahakemuksia') || 'Suodata hakemuksia' }}" ng-model="hakemusFilter"/>

                <div ng-repeat="virhe in (virheet.valintakoe | orderBy:'sukunimi' | filter:hakemusFilter | limitTo:naytaKokeita)"
                     class="valintakoe">

                    <div ng-click="show(virhe)">
                        <h2><a>{{virhe.sukunimi}}, {{virhe.etunimi}} ({{ virhe.createdAt | date:'dd.MM.yyyy HH:mm:ss'}})</a>
                        </h2>
                        <dl class="dl-horizontal" ng-show="virhe.show">
                            <dt>{{ t('yhteisvalinnanhallinta.hakemusoid') || 'Hakemus oid' }}</dt>
                            <dd>{{virhe.hakemusOid}}</dd>

                            <dt>{{ t('yhteisvalinnanhallinta.hakijaoid') || 'Hakija oid' }}</dt>
                            <dd>{{virhe.hakijaOid}}</dd>
                        </dl>
                    </div>
                    <a href="{{HAKEMUS_UI_URL_BASE}}/virkailija/hakemus/{{hakumodel.hakuOid.oid}}/esikatselu/{{virhe.hakemusOid}}"
                       target="_blank">{{ t('yhteisvalinnanhallinta.hakemuspalvelu') || 'Hakemuspalvelu' }}</a>
                    <a href="" ng-click="henkilonakyma(virhe.hakemusOid)">{{ t('yhteisvalinnanhallinta.henkilonakyma') || 'Henkilönäkymä' }}</a>

                    <table class="virkailija-table-1">
                        <thead>
                        <tr>
                            <th>{{ t('yhteisvalinnanhallinta.hakukohde') || 'Hakukohde' }}</th>
                            <th>{{ t('yhteisvalinnanhallinta.valinnanvaihe') || 'Valinnanvaihe' }}</th>
                            <th>{{ t('yhteisvalinnanhallinta.jarjestysluku') || 'Järjestysluku' }}</th>
                            <th>{{ t('yhteisvalinnanhallinta.valintakoe') || 'Valintakoe' }}</th>
                            <th>{{ t('yhteisvalinnanhallinta.tunniste') || 'Tunniste' }}</th>
                            <th>{{ t('yhteisvalinnanhallinta.osallistuminen') || 'Osallistuminen' }}</th>
                            <th>{{ t('yhteisvalinnanhallinta.kuvaus') || 'Kuvaus' }}</th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr ng-repeat="hakutoive in virhe.hakutoiveet">
                            <td><a href=""
                                   ng-click="hakukohdenakyma(hakutoive.hakukohdeOid)">{{hakutoive.hakukohdeOid}}</a>
                            </td>
                            <td ng-repeat-start="valinnanVaihe in hakutoive.valinnanVaiheet">
                                {{valinnanVaihe.valinnanVaiheOid}}
                            </td>
                            <td>{{valinnanVaihe.valinnanVaiheJarjestysluku}}</td>
                            <td ng-repeat-start="valintakoe in valinnanVaihe.valintakokeet">{{valintakoe.valintakoeOid}}
                            </td>
                            <td>{{valintakoe.valintakoeTunniste}}</td>
                            <td>{{valintakoe.osallistuminenTulos.osallistuminen}}</td>
                            <td ng-repeat-end>{{valintakoe.osallistuminenTulos.kuvaus}}</td>
                            <td ng-hide="true" ng-repeat-end></td>
                        </tr>
                        </tbody>
                    </table>

                </div>

                <a ng-show="virheet.valintakoe.length > 0 && virheet.valintakoe.length > naytaKokeita"
                   ng-click="naytaKokeita = naytaKokeita + 5" class="btn btn-default btn-sm">{{ t('yhteisvalinnanhallinta.naytalisaa') || 'Näytä lisää hakemuksia' }}</a>
            </div>
            <div ng-show="valintalaskentavirheet">
                <h2 ng-show="virheet.eiLaskentaVirheita">{{ t('yhteisvalinnanhallinta.eivirheitalaskennassa') || 'Ei virheitä laskennassa' }}</h2>

                <h2 ng-show="virheet.valintalaskenta.length > 0">{{ t('yhteisvalinnanhallinta.laskentavirheet') || 'Laskentavirheet' }}
                    ({{virheet.valintalaskenta.length}})</h2>

                <div ng-repeat="virhe in virheet.valintalaskenta" ng-click="show(virhe)">
                    <h2><a>{{virhe.show ? '-' : '+'}} {{ t('yhteisvalinnanhallinta.hakukohde') || 'Hakukohde' }}: {{ virhe.hakukohdeoid }} ({{ virhe.createdAt |
                        date:'dd.MM.yyyy HH:mm:ss'}})</a></h2>

                    <div ng-repeat="vaihe in virhe.valinnanvaihe" ng-show="virhe.show" class="valinnanvaihe">
                        <h3>{{ t('yhteisvalinnanhallinta.vaihe') || 'Vaihe' }}: {{vaihe.valinnanvaiheoid}} ({{vaihe.createdAt | date:'dd.MM.yyyy HH:mm:ss'}})</h3>

                        <h3>{{ t('yhteisvalinnanhallinta.jarjestyskriteeri') || 'Järjestyskriteeri' }}: {{vaihe.jarjestysnumero}}</h3>

                        <div ng-repeat="valintatapajono in vaihe.valintatapajonot" class="valintatapajono">
                            <h3>{{valintatapajono.nimi}}: {{valintatapajono.valintatapajonooid}}
                                ({{valintatapajono.jonosijat.length}})</h3>

                            <div ng-repeat="jonosijat in valintatapajono.jonosijat" class="jonosija"
                                 ng-click="stopPropagination($event)">
                                <div ng-click="jonosijat.lisatiedot =! jonosijat.lisatiedot">
                                    <h3><a>{{jonosijat.sukunimi}}, {{jonosijat.etunimi}}</a></h3>
                                    <dl class="dl-horizontal" ng-show="jonosijat.lisatiedot">
                                        <dt>{{ t('yhteisvalinnanhallinta.hakemusoid') || 'Hakemus oid' }}</dt>
                                        <dd>{{jonosijat.hakemusOid}}</dd>

                                        <dt>{{ t('yhteisvalinnanhallinta.hakijaoid') || 'Hakija oid' }}</dt>
                                        <dd>{{jonosijat.hakijaOid}}</dd>

                                        <dt>{{ t('yhteisvalinnanhallinta.prioriteetti') || 'Prioriteetti' }}</dt>
                                        <dd>{{jonosijat.prioriteetti}}</dd>

                                        <dt>{{ t('yhteisvalinnanhallinta.harkinnanvarainen') || 'Harkinnanvarainen' }}</dt>
                                        <dd>{{jonosijat.harkinnanvarainen ? 'Kyllä' : 'Ei'}}</dd>
                                    </dl>
                                </div>
                                <a href="{{HAKEMUS_UI_URL_BASE}}/virkailija/hakemus/{{hakumodel.hakuOid.oid}}/esikatselu/{{jonosijat.hakemusOid}}"
                                   target="_blank">{{ t('yhteisvalinnanhallinta.hakemuspalvelu') || 'Hakemuspalvelu' }}</a>
                                <a href="" ng-click="henkilonakyma(jonosijat.hakemusOid)">{{ t('yhteisvalinnanhallinta.henkilonakyma') || 'Henkilönäkymä' }}</a>
                                <a href="" ng-click="hakukohdenakyma(virhe.hakukohdeoid)">{{ t('yhteisvalinnanhallinta.hakukohdenakyma') || 'Hakukohdenäkymä' }}</a>

                                <table class="virkailija-table-1">
                                    <thead>
                                    <tr>
                                        <th>{{ t('yhteisvalinnanhallinta.prioriteetti') || 'Prioriteetti' }}</th>
                                        <th>{{ t('yhteisvalinnanhallinta.arvo') || 'Arvo' }}</th>
                                        <th>{{ t('yhteisvalinnanhallinta.kuvaus') || 'Kuvaus' }}</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="(key, value) in jonosijat.jarjestyskriteerit">
                                        <td>{{key}}</td>
                                        <td>{{value.arvo}}</td>
                                        <td>{{value.kuvaus.FI}}</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</collapsible>




</div>
