<h1>Valintojen toteuttaminen</h1>

<div ng-include="'haku/topNavigation.html'"/>

<div class="tabsheets">

<script type="text/ng-template" id="valintalaskentaModaalinenIkkuna.html">

</script>


<accordion close-others="false">
<accordion-group heading="Haun tiedot" is-open="true">
    <div class="col-md-2"><strong class="pull-right">Haku</strong></div>
    <div class="col-md-10 margin-bottom-1">{{hakumodel.hakuOid.nimi.kieli_fi}}</div>

    <div class="col-md-2"><strong class="pull-right">Haun tunniste</strong></div>
    <div class="col-md-10 margin-bottom-1">{{hakumodel.hakuOid.haunTunniste}}</div>

    <div class="col-md-2"><strong class="pull-right">Hakuvuosi</strong></div>
    <div class="col-md-10 margin-bottom-1">{{hakumodel.hakuOid.hakukausiVuosi}}</div>

    <div class="col-md-2"><strong class="pull-right">Sijoittelu</strong></div>
    <div class="col-md-10 margin-bottom-1">{{hakumodel.hakuOid.sijoittelu ? 'Kyllä' : 'Ei'}}</div>

    <div class="col-md-2"><strong class="pull-right">Hakuajat</strong></div>
    <div class="col-md-10 margin-bottom-1">
        <ul class="list-unstyled">
            <li ng-repeat="hakuaika in hakumodel.hakuOid.hakuaikas">
                <strong ng-if="hakumodel.hakuOid.hakuaikas.length > 1">{{hakuaika.nimi}}</strong>
                <span>{{hakuaika.alkuPvm | date:'dd.MM.yyyy HH:mm'}} - {{hakuaika.loppuPvm | date:'dd.MM.yyyy HH:mm'}}</span>
            </li>
        </ul>
    </div>


</accordion-group>
<accordion-group heading="Valintalaskenta ja sijoittelu" is-open="false">
    <div class="col-md-2"><strong class="pull-right">Valintalaskenta</strong></div>
    <div class="col-md-10 margin-bottom-2">
        <button privileges="valintakoekutsut" ng-click="aktivoiHaunValintakoelaskenta()"
                class="btn btn-primary btn-sm">Suorita
            valintakoelaskenta haulle
        </button>
        <button privileges="valintalaskenta" ng-click="aktivoiMuistinvarainenValintalaskenta()"
                class="btn btn-primary btn-sm">Suorita
            valintalaskenta
        </button>
    </div>
    <div class="col-md-2"><strong class="pull-right">Sijoittelu</strong></div>
    <div class="col-md-10 margin-bottom-2">
        <button ng-click="kaynnistaSijoittelu()" class="btn btn-primary btn-sm">Suorita
            sijoittelu
        </button>
        <button ng-hide="jatkuva.ajossa" ng-click="kaynnistaJatkuvaSijoittelu()"
                class="btn btn-primary btn-sm">Ota käyttöön ajastettu sijoittelu
        </button>
        <button ng-hide="!jatkuva.ajossa" ng-click="pysaytaJatkuvaSijoittelu()"
                class="btn btn-primary btn-sm">Poista käytöstä ajastettu sijoittelu
        </button>
    </div>
    <div class="col-md-2"><strong class="pull-right">Sijoittelu ajettu</strong></div>
    <div class="col-md-10 margin-bottom-1">{{sijoitteluModel.startMils | date:'dd.MM.yyyy HH:mm'}} -
        {{sijoitteluModel.endMils |
        date:'dd.MM.yyyy HH:mm'}}
    </div>
    <div class="col-md-2"><strong class="pull-right">Sijoittelu ajossa</strong></div>
    <div class="col-md-10 margin-bottom-1">{{jatkuva.ajossa ? 'Kyllä' : 'Ei'}}</div>

    <div class="col-md-2"><strong class="pull-right">Viimeksi ajettu</strong></div>
    <div class="col-md-10 margin-bottom-1">{{jatkuva.viimeksiAjettu | date:'dd.MM.yyyy HH:mm'}}</div>

    <div ng-if="jatkuva.virhe">
        <div class="col-md-2"><strong>Ajastetun sijoittelun virhe</strong></div>
        <div class="col-md-10">{{jatkuva.virhe}}</div>
    </div>

</accordion-group>

<accordion-group heading="Sijoittelun tulokset">
    <button privileges="valintalaskenta" ng-click="sijoittelunTuloksetTaulukkolaskentaan()"
            class="btn btn-default btn-sm"><i class="fa fa-table"></i>&nbsp;Vie taulukkolaskentaan
    </button>
    <button privileges="valintalaskenta" ng-click="sijoittelunTuloksetHyvaksymiskirjeiksi()"
            class="btn btn-default btn-sm"><i class="fa fa-table"></i>&nbsp;Vie hyväksymiskirjeiksi
    </button>
    <button privileges="valintalaskenta" ng-click="sijoittelunTuloksetOsoitetarrat()"
            class="btn btn-default btn-sm"><i class="fa fa-table"></i>&nbsp;Vie osoitetarroiksi
    </button>

</accordion-group>

<accordion-group heading="Jälkiohjaus">

    <button privileges="valintalaskenta" ng-click="aktivoiJalkiohjaustuloksetXls()"
            class="btn btn-default btn-sm"><i class="fa fa-table"></i>&nbsp;Vie jälkiohjaustulokset
        taulukkolaskentaan
    </button>

    <button privileges="valintalaskenta" ng-click="muodostaJalkiohjauskirjeet('FI')"
            class="btn btn-default btn-sm"><i class="fa fa-file"></i>&nbsp;Muodosta jälkiohjauskirjeet suomeksi
    </button>
    <button privileges="valintalaskenta" ng-click="muodostaJalkiohjauskirjeet('SV')"
            class="btn btn-default btn-sm"><i class="fa fa-file"></i>&nbsp;Muodosta jälkiohjauskirjeet ruotsiksi
    </button>
    <button privileges="valintalaskenta"
            href="#/haku/{{hakumodel.hakuOid.oid}}/yhteisvalinnanhallinta/valintatulos"
            class="btn btn-default btn-sm">Valinnan
        tulokset
    </button>
</accordion-group>

<accordion-group heading="Kelan tiedonsiirto">

    <div class="form-horizontal">
        <div class="form-group">
            <label class="col-md-2 control-label" for="aineistonnimi">Kela-dokumentin muodostus</label>

            <div class="col-md-2">
                <input class="form-control" id="aineistonnimi" placeholder="Aineistonnimi"
                       ng-model="aineistonnimi"/>

            </div>

            <div class="col-md-12">
            </div>

            <button style="margin-top: 5px" ng-if="!isNotBlank(aineistonnimi)" privileges="valintalaskenta"
                    popover="Kirjoita aivneistolle nimi." popover-trigger="mouseenter"
                    class="btn btn-default btn-sm disabled"><i class="fa fa-file"></i>&nbsp;Muodosta Kela-dokumentti
            </button>

            <button style="margin-top: 5px" ng-if="isNotBlank(aineistonnimi)" privileges="valintalaskenta"
                    ng-click="muodostaKelaDokumentti();$event.preventDefault();"
                    class="btn btn-default btn-sm"><i class="fa fa-file"></i>&nbsp;Muodosta Kela-dokumentti
            </button>
        </div>
    </div>
    <div class="col-md-12 margin-bottom-2" ng-hide="naytetaanHaut">
        <button class="btn btn-default btn-sm" ng-click="naytaHaut();$event.preventDefault();"><i class="fa fa-eye"></i>
            Näytä haut
        </button>
    </div>
    <div class="col-md-12">
        <table class="virkailija-table-1">
            <thead>
            <tr>
                <th colspan="3">Kela-dokumentti muodostetaan valituista hauista</th>
            </tr>
            <tr>
                <th class="col-sm-1"><input type="checkbox" ng-model="kaikkiHautValittu" ng-change="checkAll();"></th>
                <th>Haku</th>
                <th>Oid</th>
            </tr>
            </thead>
            <tbody>
            <tr class="info">
                <td><input disabled="disabled" type="checkbox" checked="checked"></td>
                <td>{{hakumodel.hakuOid.nimi.kieli_fi}}<span ng-hide="hakumodel.hakuOid.nimi.kieli_fi">{{haku.nimi.kieli_sv}}</span>
                </td>
                <td>{{hakumodel.hakuOid.oid}}</td>
            </tr>
            <tr ng-show="naytetaanHaut" ng-repeat="haku in hakumodel.haut | filter:notThisHaku">
                <td><input type="checkbox" ng-model="haku.valittu" ng-change="check();"></td>
                <td>{{haku.nimi.kieli_fi}}<span ng-hide="haku.nimi.kieli_fi">{{haku.nimi.kieli_sv}}</span></td>
                <td>{{haku.oid}}</td>
            </tr>
            </tbody>
        </table>
    </div>
</accordion-group>
<accordion-group heading="Virheet valintakokeissa ja laskennoissa" privileges="valintalaskenta" ng-click="showErrors()">
    <div ng-show="virheet.valintakoe.length > 0 || virheet.valintalaskenta.length > 0 || virheet.eiKoeVirheita || virheet.eiLaskentaVirheita">
        <div class="tabs">
            <a class="tab" ng-class="!valintalaskentavirheet ? 'current' : ''"
               ng-click="valintalaskentavirheet = false">
                <span>Valintakoevirheet</span>
            </a>
            <a class="tab" ng-class="valintalaskentavirheet ? 'current' : ''" ng-click="valintalaskentavirheet = true">
                <span>Valintalaskentavirheet</span>
            </a>
        </div>
        <div class="clear"></div>

        <div class="tabsheets hakuVirheet">
            <div ng-show="!valintalaskentavirheet">
                <h2 ng-show="virheet.eiKoeVirheita">Ei virheitä valintakokeissa</h2>

                <h2 ng-show="virheet.valintakoe.length > 0">Valintakoevirheet ({{virheet.valintakoe.length}})</h2>

                <input ng-show="virheet.valintakoe.length > 0" type="text" class="search margin-vertical-2"
                       placeholder="Suodata hakemuksia" ng-model="hakemusFilter"/>

                <div ng-repeat="virhe in (virheet.valintakoe | orderBy:'sukunimi' | filter:hakemusFilter | limitTo:naytaKokeita)"
                     class="valintakoe">

                    <div ng-click="show(virhe)">
                        <h2><a>{{virhe.sukunimi}}, {{virhe.etunimi}} ({{ virhe.createdAt | date:'dd.MM.yyyy
                            HH:mm:ss'}})</a>
                        </h2>
                        <dl class="dl-horizontal" ng-show="virhe.show">
                            <dt>Hakemus oid</dt>
                            <dd>{{virhe.hakemusOid}}</dd>

                            <dt>Hakija oid</dt>
                            <dd>{{virhe.hakijaOid}}</dd>
                        </dl>
                    </div>
                    <a href="{{HAKEMUS_UI_URL_BASE}}/virkailija/hakemus/{{hakumodel.hakuOid.oid}}/esikatselu/{{virhe.hakemusOid}}"
                       target="_blank">Hakemuspalvelu</a>
                    <a href="" ng-click="henkilonakyma(virhe.hakemusOid)">Henkilönäkymä</a>

                    <table class="virkailija-table-1">
                        <thead>
                        <tr>
                            <th>Hakukohde</th>
                            <th>Valinnanvaihe</th>
                            <th>Järjestysluku</th>
                            <th>Valintakoe</th>
                            <th>Tunniste</th>
                            <th>Osallistuminen</th>
                            <th>Kuvaus</th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr ng-repeat="hakutoive in virhe.hakutoiveet">
                            <td><a href=""
                                   ng-click="hakukohdenakyma(hakutoive.hakukohdeOid)">{{hakutoive.hakukohdeOid}}</a>
                            </td>
                            <td ng-repeat-start="valinnanVaihe in hakutoive.valinnanVaiheet">
                                {{valinnanVaihe.valinnanVaiheOid}}
                            </td>
                            <td>{{valinnanVaihe.valinnanVaiheJarjestysluku}}</td>
                            <td ng-repeat-start="valintakoe in valinnanVaihe.valintakokeet">{{valintakoe.valintakoeOid}}
                            </td>
                            <td>{{valintakoe.valintakoeTunniste}}</td>
                            <td>{{valintakoe.osallistuminenTulos.osallistuminen}}</td>
                            <td ng-repeat-end>{{valintakoe.osallistuminenTulos.kuvaus}}</td>
                            <td ng-hide="true" ng-repeat-end></td>
                        </tr>
                        </tbody>
                    </table>

                </div>

                <a ng-show="virheet.valintakoe.length > 0 && virheet.valintakoe.length > naytaKokeita"
                   ng-click="naytaKokeita = naytaKokeita + 5" class="btn btn-default btn-sm">Näytä lisää hakemuksia</a>
            </div>
            <div ng-show="valintalaskentavirheet">
                <h2 ng-show="virheet.eiLaskentaVirheita">Ei virheitä laskennassa</h2>

                <h2 ng-show="virheet.valintalaskenta.length > 0">Laskentavirheet
                    ({{virheet.valintalaskenta.length}})</h2>

                <div ng-repeat="virhe in virheet.valintalaskenta" ng-click="show(virhe)">
                    <h2><a>{{virhe.show ? '-' : '+'}} Hakukohde: {{ virhe.hakukohdeoid }} ({{ virhe.createdAt |
                        date:'dd.MM.yyyy HH:mm:ss'}})</a></h2>

                    <div ng-repeat="vaihe in virhe.valinnanvaihe" ng-show="virhe.show" class="valinnanvaihe">
                        <h3>Vaihe: {{vaihe.valinnanvaiheoid}} ({{vaihe.createdAt | date:'dd.MM.yyyy HH:mm:ss'}})</h3>

                        <h3>Järjestyskriteeri: {{vaihe.jarjestysnumero}}</h3>

                        <div ng-repeat="valintatapajono in vaihe.valintatapajonot" class="valintatapajono">
                            <h3>{{valintatapajono.nimi}}: {{valintatapajono.valintatapajonooid}}
                                ({{valintatapajono.jonosijat.length}})</h3>

                            <div ng-repeat="jonosijat in valintatapajono.jonosijat" class="jonosija"
                                 ng-click="stopPropagination($event)">
                                <div ng-click="jonosijat.lisatiedot =! jonosijat.lisatiedot">
                                    <h3><a>{{jonosijat.sukunimi}}, {{jonosijat.etunimi}}</a></h3>
                                    <dl class="dl-horizontal" ng-show="jonosijat.lisatiedot">
                                        <dt>Hakemus oid</dt>
                                        <dd>{{jonosijat.hakemusOid}}</dd>

                                        <dt>Hakija oid</dt>
                                        <dd>{{jonosijat.hakijaOid}}</dd>

                                        <dt>Prioriteetti</dt>
                                        <dd>{{jonosijat.prioriteetti}}</dd>

                                        <dt>Harkinnanvarainen</dt>
                                        <dd>{{jonosijat.harkinnanvarainen ? 'Kyllä' : 'Ei'}}</dd>
                                    </dl>
                                </div>
                                <a href="{{HAKEMUS_UI_URL_BASE}}/virkailija/hakemus/{{hakumodel.hakuOid.oid}}/esikatselu/{{jonosijat.hakemusOid}}"
                                   target="_blank">Hakemuspalvelu</a>
                                <a href="" ng-click="henkilonakyma(jonosijat.hakemusOid)">Henkilönäkymä</a>
                                <a href="" ng-click="hakukohdenakyma(virhe.hakukohdeoid)">Hakukohdenäkymä</a>

                                <table class="virkailija-table-1">
                                    <thead>
                                    <tr>
                                        <th>Prioriteetti</th>
                                        <th>Arvo</th>
                                        <th>Kuvaus</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="(key, value) in jonosijat.jarjestyskriteerit">
                                        <td>{{key}}</td>
                                        <td>{{value.arvo}}</td>
                                        <td>{{value.kuvaus.FI}}</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</accordion-group>


</accordion>


</div>