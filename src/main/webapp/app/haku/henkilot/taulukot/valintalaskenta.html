
<div ng-if="model.hakutoiveet.length">
    <table class="virkailija-table-1">
        <thead>
        <tr>
            <th colspan="2"></th>
            <th colspan="3">{{ t('valintalaskenta.valintalaskenta') || 'Valintalaskenta' }}</th>
            <th colspan="3">{{ t('valintalaskenta.sijoittelu') || 'Sijoittelu' }}</th>
        </tr>
        <tr>
            <th>{{ t('valintalaskenta.hakutoive') || 'Hakutoive' }}</th>
            <th>{{ t('valintalaskenta.valintatapajono') || 'Valintatapajono' }}
                <a href="" ng-model="filter" ng-init="false" ng-click="filter = !filter">({{filter ? 'Viimeinen' :
                    'Kaikki'}})</a>
            </th>
            <th>{{ t('valintalaskenta.yhteispisteet') || 'Yhteispisteet' }}</th>
            <th colspan="2">{{ t('valintalaskenta.valintatieto') || 'Valintatieto' }}</th>
            <th>{{ t('valintalaskenta.tila') || 'Tila' }}</th>
            <th colspan="2">{{ t('valintalaskenta.vastaanottotila') || 'Vastaanottotila' }}</th>

        </tr>
        </thead>
        <tbody ng-repeat="hakutoive in model.hakutoiveet | orderBy:'hakutoiveNumero'" ng-class-even="'tableEven'">
        <tr ng-hide="hakutoive.valintalaskenta && hakutoive.valintalaskenta[0].valintatapajonot">
            <td colspan="8">{{hakutoive.hakutoiveNumero}}. {{hakutoive.koulutuksenNimi}} -
                <a href="#/{{ model.haku.lisahaku ? 'lisa' : '' }}haku/{{model.hakuOid}}/hakukohde/{{hakutoive.hakukohdeOid}}/perustiedot">
                {{hakutoive.oppilaitos}}
                </a>
            </td>
        </tr>
        <tr ng-repeat-start="valinnanvaihe in hakutoive.valintalaskenta | orderBy: 'jarjestysnumero'" ng-show="(!filter && hakutoive.valintalaskenta) ||  (filter && hakutoive.valintalaskenta && isValinnanvaiheNameVisible($index,hakutoive.valintalaskenta))" ng-if="valinnanvaihe.valintatapajonot">
            <td>
                <div ng-if="isValinnanvaiheNameVisible($index,hakutoive.valintalaskenta)">
                    {{hakutoive.hakutoiveNumero}}. {{hakutoive.koulutuksenNimi}} -
                    <a href="#/{{ model.haku.lisahaku ? 'lisa' : '' }}haku/{{model.hakuOid}}/hakukohde/{{hakutoive.hakukohdeOid}}/perustiedot">
                        {{hakutoive.oppilaitos}}
                    </a>
                </div>
            </td>
            <td ng-repeat-start="valintatapajono in valinnanvaihe.valintatapajonot | orderBy: 'prioriteetti'">{{valintatapajono.nimi}}</span><br/>
                <span ng-bind="valinnanvaihe.createdAt | date:'dd.MM.yyyy HH:mm:ss'"></span>
            </td>
            <!-- jonosijoja pitäisi olla hakemuksella vain yksi per jono -->
            <td ng-repeat-start="tulos in valintatapajono.jonosijat">
                <span ng-if="tulos.jarjestyskriteerit[0].arvo >= 0">{{tulos.jarjestyskriteerit[0].arvo}}</span>
            </td>
            <td>
                {{tulos.tuloksenTila}}
            </td>
            <td ng-repeat-end>
                <jarjestyskriteeri-muokkaus jonosija="tulos"
                                            valintatapajono-oid="valintatapajono.valintatapajonooid"
                                            hakemus-oid="tulos.hakemusOid"
                                            enabled="updateOph"/>
            </td>
            <td>
                <span>{{model.sijoittelu[valintatapajono.valintatapajonooid].tila}}</span>
                <span ng-if="model.sijoittelu[valintatapajono.valintatapajonooid].tila == 'HYVAKSYTTY' && model.sijoittelu[valintatapajono.valintatapajonooid].hyvaksyttyHarkinnanvaraisesti == true">({{ t('valintalaskenta.harkinnanvaraisesti') || 'Harkinnanvaraisesti' }})</span>
                <span ng-if="model.sijoittelu[valintatapajono.valintatapajonooid].varasijanNumero != undefined">({{model.sijoittelu[valintatapajono.valintatapajonooid].varasijanNumero}})</span>
            </td>
            <td>{{model.sijoittelu[valintatapajono.valintatapajonooid].vastaanottoTila}}</td>
            <td ng-repeat-end>
                <sijoittelu-vastaanotto-tila hakemus="model.sijoittelu[valintatapajono.valintatapajonooid]"
                                             valintatapajono-oid="valintatapajono.valintatapajonooid"
                                             haku-oid="model.hakuOid"
                                             hakukohde-oid="hakutoive.hakukohdeOid"
                                             haku="model.haku"
                                             hakutoiveet="model.hakutoiveet"
                                             enabled="updateOph"/>
            </td>
        </tr>
        <!-- rivien väritys pitäisi hoitaa jotenkin, tai sitten muokata alkuperäinen data helpommin esitettävään muotoon -->
        <tr ng-repeat-end ng-show="false"></tr>
        </tbody>
    </table>
</div>

<div class="clear"></div>
