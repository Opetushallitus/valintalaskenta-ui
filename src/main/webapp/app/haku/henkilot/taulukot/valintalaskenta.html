<div ng-if="model.hakutoiveet.length">

    <table class="virkailija-table-1">
        <thead>
        <tr ng-if="!model.haku.lisahaku">
            <th colspan="2"></th>
            <th colspan="3" ng-if="!model.haku.lisahaku">{{ t('valintalaskenta.valintalaskenta') || 'Valintalaskenta' }}</th>
            <th colspan="3" ng-if="!model.haku.lisahaku">{{ t('valintalaskenta.sijoittelu') || 'Sijoittelu' }}</th>
        </tr>
        <tr>
            <th ng-if="!model.haku.lisahaku">{{ t('valintalaskenta.hakutoive') || 'Hakutoive' }}</th>
            <th colspan="8" ng-if="model.haku.lisahaku">{{ t('valintalaskenta.hakutoive') || 'Hakutoive' }}</th>
            <th ng-if="!model.haku.lisahaku">{{ t('valintalaskenta.valintatapajono') || 'Valintatapajono' }}
                <a href="" ng-model="model.filter" ng-init="model.filter = true" ng-click="model.filter = !model.filter">({{model.filter ? 'Näytä viimeinen' :
                    'Näytä kaikki'}})</a>
            </th>
            <th ng-if="!model.haku.lisahaku">{{ t('valintalaskenta.yhteispisteet') || 'Yhteispisteet' }}</th>
            <th colspan="2" ng-if="!model.haku.lisahaku">{{ t('valintalaskenta.valintatieto') || 'Valintatieto' }}</th>
            <th ng-if="!model.haku.lisahaku">{{ t('valintalaskenta.tila') || 'Tila' }}</th>
            <th colspan="2" ng-if="!model.haku.lisahaku">{{ t('valintalaskenta.vastaanottotila') || 'Vastaanottotila' }}</th>

        </tr>
        </thead>
        <tbody ng-repeat="hakutoive in model.hakutoiveet | orderBy:'hakutoiveNumero'" ng-class-even="'tableEven'" >
        <tr ng-hide="hakutoive.valintalaskenta && hakutoive.valintalaskenta[0].valintatapajonot && !model.haku.lisahaku">
            <td colspan="8">{{hakutoive.hakutoiveNumero}}. {{hakutoive.koulutuksenNimi}} -
                <a href="#/{{ model.haku.lisahaku ? 'lisa' : '' }}haku/{{model.hakuOid}}/hakukohde/{{hakutoive.hakukohdeOid}}/perustiedot">
                    {{hakutoive.oppilaitos}}
                </a>
            </td>
        </tr>
        <tr ng-if="!model.haku.lisahaku && hakutoive.valintalaskenta">
            <td colspan="8">
                <div class="table-group" ng-click="hakutoive.valintalaskenta.$hideRows = !hakutoive.valintalaskenta.$hideRows">
                    <span class="glyphicon" ng-class="{ 'glyphicon-chevron-right': hakutoive.valintalaskenta.$hideRows, 'glyphicon-chevron-down': !hakutoive.valintalaskenta.$hideRows }"></span>
                    <strong>{{hakutoive.hakutoiveNumero}}. {{hakutoive.koulutuksenNimi}} -</strong>
                    <a href="#/{{ model.haku.lisahaku ? 'lisa' : '' }}haku/{{model.hakuOid}}/hakukohde/{{hakutoive.hakukohdeOid}}/perustiedot">
                        <strong>{{hakutoive.oppilaitos}}</strong>
                    </a>
                </div>
            </td>
        </tr>
        <tr ng-show="false" ng-repeat-start="valinnanvaihe in hakutoive.valintalaskenta | orderBy: 'jarjestysnumero' : true" >
        </tr>

        <tr ng-if="!hakutoive.valintalaskenta.$hideRows" ng-repeat-end ng-repeat-start="valintatapajono in valinnanvaihe.valintatapajonot | orderBy: 'prioriteetti'" ng-show="model.filter || !model.filter && isValinnanvaiheVisible($index,hakutoive.valintalaskenta)">

            <td></td>
            <td>
                {{valintatapajono.nimi}}<br/>
                <span ng-bind="valinnanvaihe.createdAt | date:'dd.MM.yyyy HH:mm:ss'"></span>
            </td>
            <!-- jonosijoja pitäisi olla hakemuksella vain yksi per jono -->
            <td ng-repeat-start="tulos in valintatapajono.jonosijat">
                <span ng-if="tulos.jarjestyskriteerit[0].arvo >= 0">{{tulos.jarjestyskriteerit[0].arvo}}</span>
            </td>
            <td>
                {{tulos.tuloksenTila}}
            </td>
            <td ng-repeat-end>
                <jarjestyskriteeri-muokkaus jonosija="tulos"
                                            valintatapajono-oid="valintatapajono.valintatapajonooid"
                                            hakemus-oid="tulos.hakemusOid"
                                            enabled="updateOph"/>
            </td>
            <td>
                <span>{{model.sijoittelu[valintatapajono.valintatapajonooid].tila}}</span>
                <span ng-if="model.sijoittelu[valintatapajono.valintatapajonooid].tila == 'HYVAKSYTTY' && model.sijoittelu[valintatapajono.valintatapajonooid].hyvaksyttyHarkinnanvaraisesti == true">({{ t('valintalaskenta.harkinnanvaraisesti') || 'Harkinnanvaraisesti' }})</span>
                <span ng-if="model.sijoittelu[valintatapajono.valintatapajonooid].varasijanNumero != undefined">({{model.sijoittelu[valintatapajono.valintatapajonooid].varasijanNumero}})</span>
            </td>
            <td>{{model.sijoittelu[valintatapajono.valintatapajonooid].vastaanottoTila}}</td>
            <td>
                <sijoittelu-vastaanotto-tila hakemus="model.sijoittelu[valintatapajono.valintatapajonooid]"
                                             valintatapajono-oid="valintatapajono.valintatapajonooid"
                                             haku-oid="model.hakuOid"
                                             hakukohde-oid="hakutoive.hakukohdeOid"
                                             haku="model.haku"
                                             hakutoiveet="model.hakutoiveet"
                                             enabled="updateOph"/>
            </td>
        </tr>
        <!-- rivien väritys pitäisi hoitaa jotenkin, tai sitten muokata alkuperäinen data helpommin esitettävään muotoon -->
        <tr ng-repeat-end ng-show="false"></tr>

        </tbody>
    </table>
</div>

<div class="clear"></div>
