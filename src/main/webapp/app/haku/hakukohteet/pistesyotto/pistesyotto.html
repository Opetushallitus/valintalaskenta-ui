<h1>Valintojen toteuttaminen</h1>
<div ng-include="'haku/topNavigation.html'"/>

<div class="tabsheets">

    <div ng-include="'haku/hakukohdelista.html'"></div>

    <div class="toggle-content-container overflow-x-scroll">
        <div ng-include="'../common/html/hakukohdeNimi.html'"></div>
        <div ng-include="'haku/hakukohteet/hakukohdeNavigation.html'"/>

        <div auth="LISATIETORU LISATIETOCRUD READ_UPDATE CRUD" auth-service="APP_HAKEMUS"
             auth-org="{{hakukohdeModel.hakukohde.tarjoajaOid}}" class="tabsheets">

            <div ng-include="'../common/html/errors.html'"></div>

            <div ng-show="model.hakeneet.length > 0" class="margin-vertical-2">

                <a ng-if="arvonta" href="" ng-click="arvoPisteet()">Arvo pisteet</a>

                <input type="text" class="search margin-vertical-2" placeholder="Suodata hakijoita"
                       ng-model="hakijaFilter"/>
                <!--<input type="text" class="search margin-vertical-2" placeholder="Suodata kenttiä" ng-model="arvoFilter" />-->
                <select ng-model="koeFilter" ng-options="avain.kuvaus for avain in model.avaimet"
                        ng-change="updateFilterData()">
                    <option value="">Kaikki kokeet</option>
                </select>
                <select ng-model="osallistuminenFilter" ng-change="updateFilterData()">
                    <option value="">Kaikki tilat</option>
                    <option value="MERKITSEMATTA">Merkitsemättä</option>
                    <option value="OSALLISTUI">Osallistui</option>
                    <option value="EI_OSALLISTUNUT">Ei osallistunut</option>
                </select>
                <!--<input id="osallistuu" type="checkbox"  ng-model="vainOsallistuvat" />-->
                <!--<label for="osallistuu">Vain osallistuvat</label>-->

                <form name="form" ng-submit="submit()" ng-if="model.avaimet">
                    <button ng-disabled="!form.$valid || form.$error.arvovalidaattori.length > 0"
                            class="btn btn-primary btn-sm margin-bottom-2" type="submit">Tallenna
                    </button>
                    <div>
                        <div class="alert alert-danger" ng-show="form.$error.arvovalidaattori.length > 0">Tarkista
                            virheet!
                        </div>
                    </div>
                    <table class="virkailija-table-1" item-on-screen stay-on-focus>
                        <thead>
                        <tr>
                            <th><a href="" ng-click="predicate = 'lastName'; reverse=!reverse">Tiedot</a></th>
                            <th ng-repeat="avain in model.avaimet | filter:{'tunniste': arvoFilter.tunniste} | orderBy:'kuvaus'">
                                {{avain.kuvaus}}
                                <span ng-if="avain.min !== undefined && avain.min !== null|| avain.max !== null && avain.max !== undefined">
                                ({{avain.min}} - {{avain.max}})
                            </span>
                            </th>
                        </tr>
                        </thead>
                        <tbody>

                        <tr ng-repeat="hakija in model.hakeneet | orderBy:predicate:reverse | filter:hakijaFilter | filter:osallistuvatFilter | limitTo:limit">
                            <td class="leftorientedcolumn">
                                <show-person-information sukunimi="{{hakija.lastName}}"
                                                         etunimi="{{hakija.firstNames}}"
                                                         hakemus-oid="{{hakija.oid}}"
                                                         haku-oid="{{hakuOid}}"
                                                         henkilo-oid="{{hakemus.personOid}}"/>
                            </td>
                            <td class="rightorientedcolumn" ng-repeat="avain in model.avaimet | filter:{'tunniste': arvoFilter.tunniste} | orderBy:'kuvaus'">
                                <div ng-if="hakija.osallistuu[avain.tunniste] == 'OSALLISTUU'" ng-switch
                                     on="avain.lahde">
                                    <div ng-switch-when="SYOTETTAVA_ARVO">
                                        <div ng-switch on="avain.tyyppi()">
                                            <div ng-switch-when="input">
                                                <!-- input -->
                                                <input ng-show="hakija.additionalData[avain.osallistuminenTunniste] != 'EI_OSALLISTUNUT'"
                                                       min="{{avain.min}}"
                                                       max="{{avain.max}}"
                                                       size="2"
                                                       ng-model="hakija.additionalData[avain.tunniste]"
                                                       osallistuminen="hakija.additionalData[avain.osallistuminenTunniste]"
                                                       arvovalidaattori
                                                       ng-change="changeOsallistuminen(hakija, avain.osallistuminenTunniste, hakija.additionalData[avain.tunniste], avain.tunniste)"/>


                                                <select ng-model="hakija.additionalData[avain.osallistuminenTunniste]"
                                                        ng-if="avain.osallistuminenTunniste"
                                                        ng-change="changeArvo(hakija, avain.tunniste, hakija.additionalData[avain.osallistuminenTunniste], avain.tyyppi())"
                                                        >
                                                    <option value="MERKITSEMATTA">Merkitsemättä</option>
                                                    <option value="OSALLISTUI">Osallistui</option>
                                                    <option value="EI_OSALLISTUNUT">Ei osallistunut</option>
                                                </select>
                                                <br/>
                                                <span style="color: red;"></span>
                                            </div>

                                            <div ng-switch-when="boolean" class="input-group">
                                                <!-- input -->
                                                <span ng-if="(avain.tunniste.indexOf('kielikoe') == -1)">
                                                    <select ng-if="hakija.additionalData[avain.osallistuminenTunniste] != 'EI_OSALLISTUNUT'"
                                                            ng-model="hakija.additionalData[avain.tunniste]"
                                                            ng-change="changeOsallistuminen(hakija, avain.osallistuminenTunniste, hakija.additionalData[avain.tunniste])">

                                                        <option value="">Tyhjä</option>
                                                        <option value="true">Kyllä</option>
                                                        <option value="false">Ei</option>

                                                    </select>
                                                </span>

                                                <span ng-if="(avain.tunniste.indexOf('kielikoe') > -1)">
                                                    <select ng-if="hakija.additionalData[avain.osallistuminenTunniste] != 'EI_OSALLISTUNUT'"
                                                            ng-model="hakija.additionalData[avain.tunniste]"
                                                            ng-change="changeOsallistuminen(hakija, avain.osallistuminenTunniste, hakija.additionalData[avain.tunniste])">
                                                        <option value="">Tyhjä</option>
                                                        <option value="true">Hyväksytty</option>
                                                        <option value="false">Hylätty</option>
                                                    </select>
                                                </span>


                                                <select ng-model="hakija.additionalData[avain.osallistuminenTunniste]"
                                                        ng-if="avain.osallistuminenTunniste"
                                                        ng-change="changeArvo(hakija, avain.tunniste, hakija.additionalData[avain.osallistuminenTunniste], avain.tyyppi())"
                                                        >
                                                    <option value="MERKITSEMATTA">Merkitsemättä</option>
                                                    <option value="OSALLISTUI">Osallistui</option>
                                                    <option value="EI_OSALLISTUNUT">Ei osallistunut</option>
                                                </select>
                                                <span style="color: red;"></span>
                                            </div>


                                        </div>
                                        <div ng-switch-default>
                                            Syötetty muualla: {{hakija.additionalData[avain.tunniste]}}
                                        </div>
                                    </div>
                                    <div ng-switch-default>
                                        {{hakija.additionalData[avain.tunniste]}}
                                    </div>
                                </div>
                            </td>
                        </tr>

                        </tbody>
                    </table>
                    <button ng-disabled="!form.$valid || form.$error.arvovalidaattori.length > 0"
                            class="btn btn-primary btn-sm margin-top-2" type="submit">Tallenna
                    </button>
                    <div>
                        <div class="alert alert-danger" ng-show="form.$error.arvovalidaattori.length > 0">Tarkista
                            virheet!
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>

    <div class="clear"></div>
    <div ng-show="showLoading"
         style="position: fixed; top:0; left: 0; background: gold; padding: 0.3em; font-weight: bold;">käsitellään...
    </div>
</div>
