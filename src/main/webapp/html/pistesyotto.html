<h1>Valintojen toteuttaminen</h1>
<div ng-include="'partials/topNavigation.html'" />

<div class="tabsheets">

    <div ng-include="'partials/hakukohdelista.html'"></div>

    <div class="toggle-content-container overflow-x-scroll">
        <h1 class="margin-horizontal-1 margin-bottom-3">{{hakukohdeModel.hakukohde.hakukohdeKoodistoNimi}}</h1>
        <div ng-include="'partials/hakukohdeNavigation.html'" />

        <div auth="update" auth-service="APP_VALINTOJENTOTEUTTAMINEN" auth-org="{{hakukohdeModel.hakukohde.tarjoajaOid}}" class="tabsheets">

            <div ng-show="model.errors.length > 0" class="notification warning">
                <h3>Tietoja haettaessa tapahtui virhe</h3>
                <p ng-repeat="error in model.errors">{{error}}</p>
            </div>

            <div ng-show="model.hakeneet.length > 0" class="margin-vertical-2">
                <h2>Hakeneet</h2>

                <input type="text" class="search margin-vertical-2" placeholder="Suodata hakijoita" ng-model="hakijaFilter" />

                <form name="form" ng-submit="submit()">
                    <table class="virkailija-table-1">
                        <thead>
                        <tr>
                            <th><a href="" ng-click="predicate = 'lastName'; reverse=!reverse">Tiedot</a></th>
                            <th ng-repeat="avain in model.avaimet | filter:{'lahde': arvoFilter}">{{avain.tunniste}} {{avain.kuvaus}}
                                <span ng-show="avain.min || avain.min == 0" ng-show="avain.max || avain.max == 0">({{avain.min}} - {{avain.max}})</span>
                            </th>
                        </tr>
                        </thead>
                        <tbody>

                        <tr ng-repeat="hakija in model.hakeneet | orderBy:predicate:reverse | filter:hakijaFilter">
                            <td>
                                <a ng-click="showTiedotPartial(hakija)" >
                                    <span class="sukunimi">{{hakija.lastName}}</span>,
                                    <span class="etunimi">{{hakija.firstName}}</span>
                                </a>
                                <div ng-include="'partials/hakeneetTiedotPartial.html'"/>
                            </td>
                            <td ng-repeat="avain in model.avaimet | filter:{'lahde': arvoFilter}">
                                <div ng-show="hakija.osallistuu[avain.tunniste] == 'OSALLISTUU'" ng-switch on="avain.lahde">
                                    <div ng-switch-when="SYOTETTAVA_ARVO">
                                        <div ng-switch on="avain.tyyppi()">
                                            <div ng-switch-when="input">
                                                <!-- input -->
                                                <input ng-show="hakija.additionalData[avain.osallistuminenTunniste] != 'EI_OSALLISTUNUT'"
                                                       min="{{avain.min}}"
                                                       max="{{avain.max}}"
                                                       size="2"
                                                       ng-model="hakija.additionalData[avain.tunniste]"
                                                       arvovalidaattori
                                                       ng-change="changeOsallistuminen(hakija, avain.osallistuminenTunniste, hakija.additionalData[avain.tunniste])" />


                                                <select ng-model="hakija.additionalData[avain.osallistuminenTunniste]"
                                                        ng-show="avain.osallistuminenTunniste"
                                                        ng-change="changeArvo(hakija, avain.tunniste, hakija.additionalData[avain.osallistuminenTunniste], avain.tyyppi())"
                                                        >
                                                    <option value="MERKITSEMATTA">Merkitsemättä</option>
                                                    <option value="OSALLISTUI">Osallistui</option>
                                                    <option value="EI_OSALLISTUNUT">Ei osallistunut</option>
                                                </select>
                                                <span style="color: red;"></span>
                                            </div>

                                            <div ng-switch-when="boolean">
                                                <!-- input -->
                                                <select ng-show="hakija.additionalData[avain.osallistuminenTunniste] != 'EI_OSALLISTUNUT'"
                                                       ng-model="hakija.additionalData[avain.tunniste]"
                                                       ng-change="changeOsallistuminen(hakija, avain.osallistuminenTunniste, hakija.additionalData[avain.tunniste])" >
                                                    <option value="">Tyhjä</option>
                                                    <option value="true">Kyllä</option>
                                                    <option value="false">Ei</option>
                                                </select>


                                                <select ng-model="hakija.additionalData[avain.osallistuminenTunniste]"
                                                        ng-show="avain.osallistuminenTunniste"
                                                        ng-change="changeArvo(hakija, avain.tunniste, hakija.additionalData[avain.osallistuminenTunniste], avain.tyyppi())"
                                                        >
                                                    <option value="MERKITSEMATTA">Merkitsemättä</option>
                                                    <option value="OSALLISTUI">Osallistui</option>
                                                    <option value="EI_OSALLISTUNUT">Ei osallistunut</option>
                                                </select>
                                                <span style="color: red;"></span>
                                            </div>


                                        </div>
                                        <div ng-switch-default>
                                            Syötetty muualla: {{hakija.additionalData[avain.tunniste]}}
                                        </div>
                                    </div>
                                    <div ng-switch-default>
                                        {{hakija.additionalData[avain.tunniste]}}
                                    </div>
                                </div>
                            </td>
                        </tr>

                        </tbody>
                    </table>

                    <button ng-disabled="!form.$valid" class="button small primary margin-top-2" type="submit">Tallenna</button>
                    <div>
                        <div class="notification warning" ng-show="form.$error.arvovalidaattori">Tarkista virheet!</div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="clear"></div>
</div>
